<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no"/>
  <title>Sforzu v6.6 ‚Ä¢ Wizard Clinico (offline)</title>
  <meta name="theme-color" content="#0b0b0c"/>
  <link rel="manifest" href="manifest.webmanifest"/>
  <link rel="apple-touch-icon" href="icons/icon-192.png"/>
  <link rel="stylesheet" href="styles.css"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
</head>
<body>
<header class="app-header"><h1>Sforzu</h1></header>

<main id="wizard">
  <!-- STEP 0 -->
  <section class="step active" data-step="0">
    <h2>Cosa vuoi fare?</h2>
    <div class="chooser">
      <button class="big" id="choose_watt">üö¥ Watt Test</button>
      <button class="big" id="choose_cpet">ü´Å CPET</button>
    </div>
  </section>

  <!-- STEP 0a: DEVICE -->
  <section class="step" data-step="0a">
    <h2>Seleziona l‚Äôergometro</h2>
    <p id="device_note" class="hint"></p>
    <div class="chooser">
      <button class="big" id="choose_cycle">üö¥‚Äç‚ôÇÔ∏è Cicloergometro</button>
      <button class="big" id="choose_treadmill">üèÉ Treadmill</button>
    </div>
  </section>

  <!-- STEP 1 -->
  <section class="step" data-step="1">
    <h2>Dati del paziente</h2>
    <div class="grid">
      <label>Et√† (anni)<input type="number" id="age" min="5" max="95"/></label>
      <label>Sesso
        <select id="sex"><option value="M">Maschio</option><option value="F">Femmina</option></select>
      </label>
      <label>Altezza (cm)<input type="number" id="height" min="80" max="220"/></label>
      <label>Peso (kg)<input type="number" id="weight" min="15" max="220" step="0.1"/></label>
      <label>Attivit√† fisica (ore/settimana)<input type="number" id="train_h" min="0" max="30" step="0.5"/></label>
    </div>

    <details class="card">
      <summary>Profilo clinico (opzionale)</summary>
      <div class="tags">
        <label class="tag"><input type="checkbox" id="p_ihd"> Cardiopatia ischemica</label>
        <label class="tag"><input type="checkbox" id="p_hf"> Insufficienza cardiaca</label>
        <label class="tag"><input type="checkbox" id="p_copd"> BPCO</label>
        <label class="tag"><input type="checkbox" id="p_ob"> Obesit√†</label>
        <label class="tag"><input type="checkbox" id="p_elder"> Anziano</label>
        <label class="tag"><input type="checkbox" id="p_ath"> Atleta</label>
        <label class="tag"><input type="checkbox" id="p_bb"> Beta-bloccante</label>
      </div>
    </details>

    <div id="spiro_block" class="card hidden">
      <h3>Spirometria pre-test (solo CPET)</h3>
      <div class="grid">
        <label>FVC (L)<input type="number" id="sp_fvc" step="0.01"/></label>
        <label>FEV‚ÇÅ (L)<input type="number" id="sp_fev1" step="0.01"/></label>
        <label>FEV‚ÇÅ/FVC (%)<input type="number" id="sp_ratio" step="0.1" placeholder="auto"/></label>
        <label>MVV (L/min) <small>(se assente stimata 40√óFEV‚ÇÅ)</small><input type="number" id="sp_mvv" step="1"/></label>
      </div>
      <details class="card">
        <summary>Predetti/LLN opzionali</summary>
        <div class="grid">
          <label>FVC pred (L)<input type="number" id="sp_fvc_pred" step="0.01"/></label>
          <label>FEV‚ÇÅ pred (L)<input type="number" id="sp_fev1_pred" step="0.01"/></label>
          <label>FEV‚ÇÅ/FVC LLN (%)<input type="number" id="sp_ratio_lln" step="0.1" placeholder="70"/></label>
        </div>
      </details>
      <details class="card">
        <summary>Mini-wizard predetti (educativo)</summary>
        <div class="grid">
          <label>Et√† (anni)<input type="number" id="wiz_age"/></label>
          <label>Sesso<select id="wiz_sex"><option value="M">M</option><option value="F">F</option></select></label>
          <label>Altezza (cm)<input type="number" id="wiz_h"/></label>
        </div>
        <div class="row">
          <button id="wiz_calc" class="secondary">Calcola predetti rapidi</button>
          <button id="wiz_apply" class="secondary">Applica ai campi</button>
        </div>
        <div id="wiz_out" class="results"></div>
      </details>
      <div id="spiro_out" class="results"></div>
    </div>

    <div class="nav">
      <button id="step1_next" class="primary">Calcola predetti e suggerisci protocollo</button>
    </div>
    <div id="pred_summary" class="results"></div>

    <div id="proto_suggestion" class="card hidden">
      <h3>Suggerimento protocollo</h3>
      <div id="proto_sug_text" class="results"></div>
      <div class="row">
        <button id="copy_suggestion" class="secondary">Copia nello Step 2</button>
      </div>
    </div>
  </section>

  <!-- STEP 2 -->
  <section class="step" data-step="2">
    <h2>Protocollo</h2>

    <!-- Cycle block -->
    <div id="cycle_block" class="grid">
      <label>Tipo di prova
        <select id="proto_type">
          <option value="ramp">Rampa</option>
          <option value="step">A step</option>
          <option value="constant">Carico costante</option>
          <option value="monark">Monark (kgf√órpm)</option>
        </select>
      </label>
      <label>Durata target (min)<input type="number" id="target_min" value="10" step="0.5"/></label>
      <label>Start (W)<input type="number" id="start_w" value="20" step="5"/></label>
      <label>ŒîW/min o step (W)<input type="number" id="inc_w" value="15" step="1"/></label>
      <label>Durata step (min, se step)<input type="number" id="step_min" value="2" step="0.5"/></label>
      <label>ŒîVO‚ÇÇ/ŒîWR (mL/min/W)<input type="number" id="gain" value="10" step="0.1"/></label>
    </div>

    <!-- Treadmill block -->
    <div id="tm_block" class="grid hidden">
      <label>Protocollo treadmill
        <select id="tm_proto">
          <option value="ramp_tm">Rampa personalizzata</option>
          <option value="mod_bruce">Modified Bruce (suggerito)</option>
          <option value="bruce">Bruce</option>
          <option value="naughton">Naughton</option>
          <option value="balke">Balke</option>
        </select>
      </label>
      <label>Durata target (min)<input type="number" id="tm_target" value="10" step="0.5"/></label>
      <label>Velocit√† start (km/h)<input type="number" id="tm_speed0" value="3.0" step="0.1"/></label>
      <label>Pendenza start (%)<input type="number" id="tm_grade0" value="0" step="0.5"/></label>
      <label>Œî velocit√† per step (km/h)<input type="number" id="tm_dspeed" value="0.2" step="0.1"/></label>
      <label>Œî pendenza per step (%)<input type="number" id="tm_dgrade" value="1" step="0.5"/></label>
      <label>Durata step (min)<input type="number" id="tm_stepmin" value="1" step="0.5"/></label>
    </div>

    <!-- Treadmill METs preview -->
    <div id="tm_mets_card" class="card hidden">
      <h3>Stima METs treadmill (preview)</h3>
      <div id="tm_mets_out" class="results"></div>
      <div class="row">
        <button id="tm_copy_to_cpet" class="secondary">Usa come stima VO‚ÇÇ/kg in CPET</button>
      </div>
    </div>

    <div class="card" id="monark_block" style="display:none">
      <h3>Monark kgf ‚Üî Watt</h3>
      <div class="grid">
        <label>rpm<input type="number" id="m_rpm" value="60"/></label>
        <label>kgf<input type="number" id="m_kgf" value="1.5" step="0.1"/></label>
        <label>Watt<input type="number" id="m_w" value="550"/></label>
      </div>
      <div class="row">
        <button id="m_from_kgf">Calcola W</button>
        <button id="m_from_w">Calcola kgf</button>
      </div>
      <div id="m_out" class="results"></div>
    </div>

    <div id="proto_out" class="results"></div>
    <div class="nav">
      <button class="secondary" id="back_to_1">Indietro</button>
      <button class="primary" id="step2_next">Avvia test</button>
    </div>
  </section>

  <!-- STEP 3 -->
  <section class="step" data-step="3">
    <h2>Risultati misurati</h2>

    <div class="card">
      <label>Formula FC max predetta
        <select id="hrmax_formula">
          <option value="fox">Fox: 220 ‚àí et√†</option>
          <option value="tanaka">Tanaka: 208 ‚àí 0.7√óet√†</option>
        </select>
      </label>
    </div>

    <!-- WATT TEST fields -->
    <div id="watt_fields" class="grid hidden">
      <label>Watt di picco (W)<input type="number" id="r_wpeak"/></label>
      <label>W/kg di picco<input type="number" id="r_wkg" placeholder="auto" step="0.01"/></label>
      <label>Durata prova (min)<input type="number" id="r_dur" step="0.1"/></label>

      <label>FC riposo (bpm)<input type="number" id="r_hrrest_w"/></label>
      <label>FC picco (bpm)<input type="number" id="r_hrmax_w"/></label>
      <label>FC a 1‚Ä≤ recupero (bpm)<input type="number" id="r_hr1_w"/></label>
      <label>FC a 3‚Ä≤ recupero (bpm)<input type="number" id="r_hr3_w"/></label>

      <label>SpO‚ÇÇ nadir (%)<input type="number" id="r_spo2_w"/></label>
      <label>Borg max (6‚Äì20)<input type="number" id="r_borg_w"/></label>

      <label>SBP riposo (mmHg)<input type="number" id="r_sbp_rest"/></label>
      <label>DBP riposo (mmHg)<input type="number" id="r_dbp_rest"/></label>
      <label>SBP picco (mmHg)<input type="number" id="r_sbp"/></label>
      <label>DBP picco (mmHg)<input type="number" id="r_dbp"/></label>
      <label>SBP 1‚Ä≤ (mmHg)<input type="number" id="r_sbp1"/></label>
      <label>DBP 1‚Ä≤ (mmHg)<input type="number" id="r_dbp1"/></label>
      <label>SBP 3‚Ä≤ (mmHg)<input type="number" id="r_sbp3"/></label>
      <label>DBP 3‚Ä≤ (mmHg)<input type="number" id="r_dbp3"/></label>
    </div>

    <div id="watt_criteria" class="card hidden">
      <h3>Criteri di interruzione osservati (promemoria)</h3>
      <div class="tags">
        <label class="tag"><input type="checkbox" id="c_angina"> Angina moderata-severa</label>
        <label class="tag"><input type="checkbox" id="c_drop_sbp"> Caduta SBP >10 mmHg con ‚Üë carico</label>
        <label class="tag"><input type="checkbox" id="c_hypertension"> Ipertensione marcata (es. SBP>250 o DBP>115)</label>
        <label class="tag"><input type="checkbox" id="c_arrhythmia"> Aritmie ventricolari sostenute</label>
        <label class="tag"><input type="checkbox" id="c_syncope"> Vertigini/sincope</label>
        <label class="tag"><input type="checkbox" id="c_hypoperfusion"> Segni di scarsa perfusione</label>
        <label class="tag"><input type="checkbox" id="c_spo2"> SpO‚ÇÇ <85%</label>
        <label class="tag"><input type="checkbox" id="c_dyspnea"> Dispnea/cianosi severa</label>
      </div>
      <p class="hint">Seleziona solo se presenti: √® un promemoria operativo, non sostituisce il giudizio clinico.</p>
    </div>

    <!-- CPET fields -->
    <div id="cpet_fields" class="grid hidden">
      <label>VO‚ÇÇ peak (mL/min)<input type="number" id="r_vo2pk"/></label>
      <label>VO‚ÇÇ/kg (mL¬∑kg‚Åª¬π¬∑min‚Åª¬π)<input type="number" id="r_vo2kg"/></label>
      <label>VE/VCO‚ÇÇ slope<input type="number" id="r_slope"/></label>
      <label>OUES<input type="number" id="r_oues" step="0.01"/></label>
      <label>VEmax (L/min)<input type="number" id="r_vemax"/></label>

      <label>FC riposo (bpm)<input type="number" id="r_hrrest"/></label>
      <label>FC picco (bpm)<input type="number" id="r_hrmax"/></label>
      <label>FC a 1‚Ä≤ recupero (bpm)<input type="number" id="r_hr1"/></label>
      <label>FC a 3‚Ä≤ recupero (bpm)<input type="number" id="r_hr3"/></label>

      <label>RER max<input type="number" id="r_rer" step="0.01"/></label>
      <label>SpO‚ÇÇ nadir (%)<input type="number" id="r_spo2"/></label>
      <label>Borg max (6‚Äì20)<input type="number" id="r_borg"/></label>

      <label>SBP riposo (mmHg)<input type="number" id="c_sbp_rest"/></label>
      <label>DBP riposo (mmHg)<input type="number" id="c_dbp_rest"/></label>
      <label>SBP picco (mmHg)<input type="number" id="c_sbp"/></label>
      <label>DBP picco (mmHg)<input type="number" id="c_dbp"/></label>
      <label>SBP 1‚Ä≤ (mmHg)<input type="number" id="c_sbp1"/></label>
      <label>DBP 1‚Ä≤ (mmHg)<input type="number" id="c_dbp1"/></label>
      <label>SBP 3‚Ä≤ (mmHg)<input type="number" id="c_sbp3"/></label>
      <label>DBP 3‚Ä≤ (mmHg)<input type="number" id="c_dbp3"/></label>
    </div>

    <div class="nav">
      <button class="secondary" id="back_to_2a">Indietro</button>
      <button class="primary" id="step3_next">Analizza risultati</button>
    </div>
  </section>

  <!-- STEP 4 -->
  <section class="step" data-step="4">
    <h2>Interpretazione</h2>
    <div id="report" class="report"></div>
    <div class="nav"><button class="primary" id="restart">Nuovo test</button></div>
  </section>
</main>

<footer class="app-footer"><button id="installBtn" hidden>Aggiungi a Home</button></footer>
<script src="app.js"></script>
</body>
</html>
