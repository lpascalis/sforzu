<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="assets/logo.png">
  <title>Sforzu</title>
  <style>
    :root{--bg:#0b0b0c;--card:#141417;--ink:#f4f6fb;--muted:#a5a6ad;--accent:#58a6ff;--ok:#34d399;--warn:#f59e0b;--bad:#ef4444}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    header{display:flex;gap:.7rem;align-items:center;padding:12px 16px;border-bottom:1px solid #222}
    header img{width:28px;height:28px;border-radius:6px;object-fit:cover}
    header h1{font-size:18px;margin:0;font-weight:700;letter-spacing:.3px}
    main{padding:16px;max-width:980px;margin:0 auto}
    .card{background:var(--card);border:1px solid #232329;border-radius:16px;padding:16px;margin-bottom:14px;box-shadow:0 6px 18px rgba(0,0,0,.28)}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:740px){.row-2{grid-template-columns:1fr 1fr}.row-3{grid-template-columns:1fr 1fr 1fr}}
    label{display:block;color:var(--muted);font-size:14px;margin-bottom:6px}
    input,select,textarea{width:100%;background:#0e0e11;border:1px solid #292932;color:var(--ink);padding:10px 12px;border-radius:12px;font-size:16px}
    .btn{display:inline-flex;align-items:center;gap:.5rem;background:var(--accent);color:#001225;border:0;padding:10px 14px;border-radius:12px;font-weight:700}
    .btn.secondary{background:#1f2937;color:#d1d5db}
    .btn.ghost{background:transparent;border:1px solid #2a2a33;color:#c9cad1}
    .btnbar{display:flex;gap:10px;flex-wrap:wrap}
    .hidden{display:none!important}
    .hint{color:var(--muted);font-size:13px}
    .results b{color:#fff}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
    .title{font-size:16px;font-weight:700;margin:0 0 8px}
    textarea.report{min-height:260px}
    .selector{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .selector button{padding:18px 16px;font-size:16px}
    details>summary{cursor:pointer;padding:10px 12px;background:#0e0e11;border:1px solid #292932;border-radius:12px;margin:-6px 0 10px;color:#d1d5db}
  </style>
</head>
<body>
<header>
  <img src="assets/logo.png" alt="Sforzu">
  <h1>Sforzu — Watt Test & CPET</h1>
</header>
<main>
  <div class="card" id="start">
    <div class="title">Seleziona esame</div>
    <div class="selector">
      <button class="btn" id="sel_watt">WATT TEST</button>
      <button class="btn secondary" id="sel_cpet">CPET</button>
    </div>
  </div>

  <div class="card hidden" id="common">
    <div class="title">Dati paziente</div>
    <div class="row row-3">
      <div><label>Età (anni)</label><input id="age" type="number" inputmode="decimal"></div>
      <div><label>Sesso</label><select id="sex"><option value="M">Maschio</option><option value="F">Femmina</option></select></div>
      <div><label>Altezza (cm)</label><input id="height" type="number" inputmode="decimal"></div>
      <div><label>Peso (kg)</label><input id="weight" type="number" inputmode="decimal"></div>
      <div><label>Ergometro</label><select id="ergotype"><option value="cycle">Cicloergometro</option><option value="tm">Treadmill</option></select></div>
      <div><label>Attività fisica (ore/sett.)</label><input id="pa_hours" type="number" inputmode="decimal"></div>
    </div>
    <div class="row"><div><label>Diagnosi/Note cliniche</label><input id="dx" placeholder="es. cardiopatia ischemica, atleta, BPCO…"></div></div>
  </div>

  <div class="card hidden" id="proto_card">
    <div class="title">Protocollo consigliato</div>
    <div class="hint" id="proto_text">Inserisci età, peso e attività per il suggerimento.</div>
    <div class="btnbar">
      <button class="btn secondary" id="apply_proto">Usa parametri suggeriti</button>
      <button class="btn ghost" id="switch_exam">Cambia esame</button>
    </div>
  </div>

  <!-- WATT TEST -->
  <div class="card hidden" id="watt_block">
    <div class="title">Watt Test — Parametri</div>
    <div class="row row-3">
      <div><label>Carico iniziale (W)</label><input id="w_start" type="number"></div>
      <div><label>Rampa/step (W/min)</label><input id="w_ramp" type="number"></div>
      <div><label>Durata prevista (min)</label><input id="w_dur" type="number"></div>
    </div>
    <details><summary>Parametri emodinamici (misurati)</summary>
      <div class="row row-3">
        <div><label>FC riposo (bpm)</label><input id="r_hrrest" type="number"></div>
        <div><label>FC picco (bpm)</label><input id="r_hrmax" type="number"></div>
        <div><label>HR recovery 1' (bpm)</label><input id="r_hrrec1" type="number"></div>
        <div><label>PAS picco (mmHg)</label><input id="r_pas" type="number"></div>
        <div><label>PAD picco (mmHg)</label><input id="r_pad" type="number"></div>
        <div><label>PA recupero 3' (PAS/PAD)</label><input id="r_parec" placeholder="es. 130/80"></div>
        <div><label>Borg dispnea</label><input id="r_borg" type="number" step="0.5"></div>
        <div><label>Doppio prodotto (auto)</label><input id="r_dp" disabled placeholder="FC×PAS al picco"></div>
      </div>
    </details>
    <details><summary>Prestazione</summary>
      <div class="row row-3">
        <div><label>Watt massimi</label><input id="r_wmax" type="number"></div>
        <div><label>W/kg</label><input id="r_wkg" type="number" placeholder="auto se peso inserito"></div>
        <div><label>Durata effettiva (min)</label><input id="r_dur" type="number"></div>
        <div><label>METs stimati (auto)</label><input id="r_mets" disabled></div>
      </div>
    </details>
    <div class="btnbar" style="margin-top:10px">
      <button class="btn" id="analyze_watt">Analizza Watt</button>
    </div>
    <div class="results" id="watt_results"></div>
  </div>

  <!-- CPET -->
  <div class="card hidden" id="spiro_block">
    <div class="title">CPET — Spirometria (pre-test)</div>
    <div class="row row-3">
      <div><label>Metodo predetti</label>
        <select id="sp_method"><option value="lms_rn" selected>Predetti LMS (race-neutral)</option><option value="quick">Stima rapida</option></select>
      </div>
      <div><label>FEV₁ misurato (L)</label><input id="sp_fev1" type="number" step="0.01"></div>
      <div><label>FVC misurata (L)</label><input id="sp_fvc" type="number" step="0.01"></div>
      <div><label>FEV₁/FVC (%)</label><input id="sp_ratio" type="number" step="0.1" placeholder="Se vuoto, calcolo da FEV₁ e FVC"></div>
    </div>
    <div class="results" id="sp_pred_box"></div>
    <div class="results" id="sp_lms_box"><b>LMS, Z-score, LLN:</b> <span id="sp_lms_text" class="hint">Inserisci età/altezza e misurati.</span></div>
    <div class="results" id="sp_flag_box"></div>
  </div>

  <div class="card hidden" id="cpet_block">
    <div class="title">CPET — Misurati principali</div>
    <div class="row row-3">
      <div><label>Durata (min)</label><input id="r_dur_c" type="number"></div>
      <div><label>VO₂ picco (ml/min/kg)</label><input id="r_vo2" type="number" step="0.1"></div>
      <div><label>RER picco</label><input id="r_rer" type="number" step="0.01"></div>
      <div><label>VE/VCO₂ slope</label><input id="r_vevco2" type="number" step="0.1"></div>
      <div><label>O₂ pulse picco (ml/batt)</label><input id="r_o2pulse" type="number" step="0.1"></div>
      <div><label>HR riposo/picco (bpm)</label><input id="r_hr_pair" placeholder="es. 68/152"></div>
    </div>
    <details><summary>CPET — Parametri ventilatori avanzati</summary>
      <div class="row row-3">
        <div><label>AT (VO₂ @ AT, ml/min/kg)</label><input id="r_at" type="number" step="0.1"></div>
        <div><label>BR al picco (%)</label><input id="r_br" type="number" step="0.1" placeholder="Breathing reserve"></div>
        <div><label>VE/MVV (%)</label><input id="r_vemvv" type="number" step="0.1"></div>
        <div><label>EqO₂ al picco</label><input id="r_eqo2" type="number" step="0.1"></div>
        <div><label>EqCO₂ al picco</label><input id="r_eqco2" type="number" step="0.1"></div>
        <div><label>PETCO₂ al AT (mmHg)</label><input id="r_petco2" type="number" step="0.1"></div>
        <div><label>OUES</label><input id="r_oues" type="number" step="0.01"></div>
      </div>
    </details>
    <div class="btnbar" style="margin-top:10px">
      <button class="btn" id="analyze_cpet">Analizza CPET</button>
    </div>
    <div class="results" id="cpet_results"></div>
  </div>

  <div class="card hidden" id="report_card">
    <div class="title">Referto</div>
    <div class="btnbar">
      <button class="btn secondary" id="short_rep">Referto sintetico</button>
      <button class="btn" id="long_rep">Referto completo</button>
    </div>
    <textarea class="report" id="report" placeholder="Il referto verrà compilato qui…"></textarea>
  </div>
</main>
<script src="app.js"></script>
</body>
</html>
