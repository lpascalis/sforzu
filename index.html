<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Sforzu v8.1</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0ea5e9">
<link rel="apple-touch-icon" href="assets/icon-192.png">
<style>
:root{--bg:#0b0c0f;--fg:#e5e7eb;--card:#0f172a;--muted:#94a3b8;--accent:#0ea5e9;--ok:#10b981;--warn:#f59e0b;--bad:#ef4444}
@media (prefers-color-scheme:light){:root{--bg:#f8fafc;--fg:#111827;--card:#fff}}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--fg);font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial}
header{position:sticky;top:0;display:flex;align-items:center;gap:.6rem;padding:.6rem 1rem;background:#020617cc;backdrop-filter:blur(10px);z-index:10}
header img{width:28px;height:28px;border-radius:6px}
h1{font-size:1.05rem;margin:0}
main{padding:1rem;max-width:980px;margin:0 auto}
.grid{display:grid;gap:1rem;grid-template-columns:1fr 1fr}
@media(max-width:760px){.grid{grid-template-columns:1fr}}
.card{background:var(--card);border:1px solid #ffffff29;border-radius:18px;padding:1rem;box-shadow:0 8px 26px #0003}
.title{margin:.2rem 0 .6rem;font-weight:800}
.muted{color:var(--muted);font-size:.92rem}
.btn{display:inline-flex;justify-content:center;align-items:center;width:100%;padding:.85rem 1rem;border-radius:14px;border:1px solid #94a3b859;background:linear-gradient(180deg,#0ea5e9,#0284c7);color:#fff;font-weight:800}
.btn.secondary{background:transparent;color:inherit}
.row{display:grid;grid-template-columns:1fr 1fr;gap:.6rem}
.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:.6rem}
label{font-size:.8rem;color:var(--muted);display:block;margin:.2rem 0}
input,select,textarea{width:100%;padding:.78rem .9rem;border-radius:12px;border:1px solid #94a3b859;background:transparent;color:inherit}
.badge{padding:.2rem .45rem;border-radius:999px;font-size:.78rem;font-weight:700;display:inline-block}
.badge.ok{background:#10b9811a;color:#10b981}
.badge.warn{background:#f59e0b1a;color:#f59e0b}
.badge.bad{background:#ef44441a;color:#ef4444}
.kpi{display:flex;gap:.6rem;flex-wrap:wrap}
.kpi .card{padding:.7rem .9rem}
.kpi .v{font-size:1.05rem;font-weight:800}
.section{margin:.8rem 0 .4rem;font-weight:800}
table{width:100%;border-collapse:collapse}
th,td{padding:.5rem .6rem;border-bottom:1px dashed #94a3b845;text-align:left;font-size:.92rem}
.hidden{display:none}
.foot{margin-top:1rem;color:var(--muted);font-size:.8rem}
.small{font-size:.86rem;color:var(--muted)}
.tip{font-size:.9rem;color:#e2e8f0;background:#33415566;border:1px dashed #94a3b866;border-radius:12px;padding:.6rem .7rem}
</style>
</head>
<body>
<header><img src="assets/icon-192.png" alt="Sforzu"><h1>Sforzu</h1></header>
<main>
  <div id="home" class="grid">
    <div class="card">
      <h2 class="title">Watt Test</h2>
      <p class="muted">Test incrementale senza parametri ventilatori. Predetti, performance, cut-off e interpretazione.</p>
      <button class="btn" onclick="nav('watt')">Avvia wizard</button>
    </div>
    <div class="card">
      <h2 class="title">CPET</h2>
      <p class="muted">Cardiopulmonary Exercise Test con indici ventilatori e punteggi prognostici. Spirometria pre-test opzionale.</p>
      <button class="btn" onclick="nav('cpet')">Avvia wizard</button>
    </div>
    <div class="card">
      <h2 class="title">Spirometria</h2>
      <p class="muted">Predetti GLI semplificati, % e Z-score, LLN e pattern (ostr./restr./misto).</p>
      <button class="btn" onclick="nav('spiro')">Apri</button>
    </div>
  </div>

  <!-- WATT TEST -->
  <div id="watt" class="hidden">
    <div class="card">
      <h2 class="title">Watt Test • Dati paziente e protocollo</h2>
      <div class="row">
        <div><label>Età</label><input id="w_age" type="number"></div>
        <div><label>Sesso</label><select id="w_sex"><option value="M">Maschio</option><option value="F">Femmina</option></select></div>
      </div>
      <div class="row">
        <div><label>Altezza (cm)</label><input id="w_h" type="number"></div>
        <div><label>Peso (kg)</label><input id="w_w" type="number" step="0.1"></div>
      </div>
      <div class="row">
        <div><label>Modalità</label><select id="w_mode"><option value="cycle">Cicloergometro</option><option value="treadmill">Treadmill</option></select></div>
        <div><label>Profilo</label><select id="w_prof">
          <option value="std">Standard</option>
          <option value="sedent">Sedentario</option>
          <option value="ath">Atleta</option>
          <option value="elder">Anziano/Frailty</option>
          <option value="ihd">Cardiopatia ischemica</option>
          <option value="hf">Scompenso cardiaco</option>
          <option value="copd">BPCO/Asma</option>
          <option value="postcovid">Post-COVID/decondiz.</option>
        </select></div>
      </div>
      <div class="row">
        <div><label>Ore attività fisica/settimana</label><input id="w_act" type="number" step="0.1" value="0"></div>
        <div><label>Suggerimento</label><button class="btn secondary" onclick="suggest('w_')">Suggerisci protocollo</button></div>
      </div>
      <div class="tip" id="w_tip">Premi “Suggerisci protocollo” per calcolare rampa e carico iniziale ottimali (obiettivo 8–12′).</div>
      <div class="row">
        <div><label>Rampa (W/min)</label><input id="w_ramp" type="number" value="15"></div>
        <div><label>Carico iniziale (W)</label><input id="w_wstart" type="number" value="20"></div>
      </div>
      <div class="row">
        <div><label>Durata attesa (min, auto)</label><input id="w_dur" type="number" step="0.1" placeholder="auto"></div>
        <div><label>Watt massimi (W)</label><input id="w_wmax" type="number"></div>
      </div>
      <div class="row">
        <div><label>W/kg (opzionale)</label><input id="w_wkg" type="number" step="0.01"></div>
        <div></div>
      </div>
      <div class="row">
        <div><label>FC riposo</label><input id="w_hr0" type="number"></div>
        <div><label>FC picco</label><input id="w_hrp" type="number"></div>
      </div>
      <div class="row">
        <div><label>HR recovery 1′</label><input id="w_hrr1" type="number"></div>
        <div><label>PA riposo (PAS/PAD)</label><input id="w_bp0" placeholder="120/80"></div>
      </div>
      <div class="row">
        <div><label>PA picco (PAS/PAD)</label><input id="w_bpp" placeholder="190/90"></div>
        <div><label>Note</label><input id="w_notes" placeholder="annotazioni cliniche"></div>
      </div>
      <div class="row">
        <button class="btn secondary" onclick="nav('home')">Indietro</button>
        <button class="btn" onclick="calcWatt()">Calcola</button>
      </div>
    </div>
    <div id="watt-res" class="card hidden"></div>
  </div>

  <!-- CPET -->
  <div id="cpet" class="hidden">
    <div class="card">
      <h2 class="title">CPET • Dati paziente e protocollo</h2>
      <div class="row">
        <div><label>Età</label><input id="c_age" type="number"></div>
        <div><label>Sesso</label><select id="c_sex"><option value="M">Maschio</option><option value="F">Femmina</option></select></div>
      </div>
      <div class="row">
        <div><label>Altezza (cm)</label><input id="c_h" type="number"></div>
        <div><label>Peso (kg)</label><input id="c_w" type="number" step="0.1"></div>
      </div>
      <div class="row">
        <div><label>Modalità</label><select id="c_mode"><option value="cycle">Cicloergometro</option><option value="treadmill">Treadmill</option></select></div>
        <div><label>Profilo</label><select id="c_prof">
          <option value="std">Standard</option>
          <option value="sedent">Sedentario</option>
          <option value="ath">Atleta</option>
          <option value="elder">Anziano/Frailty</option>
          <option value="ihd">Cardiopatia ischemica</option>
          <option value="hf">Scompenso cardiaco</option>
          <option value="copd">BPCO/Asma</option>
          <option value="postcovid">Post-COVID/decondiz.</option>
        </select></div>
      </div>
      <div class="row">
        <div><label>Ore attività fisica/settimana</label><input id="c_act" type="number" step="0.1" value="0"></div>
        <div><label>Suggerimento</label><button class="btn secondary" onclick="suggest('c_')">Suggerisci protocollo</button></div>
      </div>
      <div class="tip" id="c_tip">Premi “Suggerisci protocollo” per calcolare rampa e carico iniziale ottimali (obiettivo 8–12′).</div>
      <div class="row">
        <div><label>Rampa (W/min)</label><input id="c_ramp" type="number" value="15"></div>
        <div><label>Carico iniziale (W)</label><input id="c_wstart" type="number" value="20"></div>
      </div>
      <div class="row">
        <div><label>Durata attesa (min, auto)</label><input id="c_dur" type="number" step="0.1" placeholder="auto"></div>
        <div><label>Watt massimi (W)</label><input id="c_wmax" type="number"></div>
      </div>

      <div class="section">Spirometria pre-test (opzionale)</div>
      <div class="row">
        <div><label>Abilita</label><select id="c_spiro_on"><option value="no">No</option><option value="si">Sì</option></select></div>
        <div></div>
      </div>
      <div id="c_spiro" class="hidden">
        <div class="row">
          <div><label>FEV₁ (L)</label><input id="c_fev1" type="number" step="0.01"></div>
          <div><label>FVC (L)</label><input id="c_fvc" type="number" step="0.01"></div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2 class="title">CPET • Parametri di picco / ventilatori</h2>
      <div class="row3">
        <div><label>Watt massimi (W)</label><input id="c_wmax2" type="number" placeholder="se diverso"></div>
        <div><label>VO₂ picco (ml/kg/min)</label><input id="c_vo2pk" type="number" step="0.1"></div>
        <div><label>RER picco</label><input id="c_rer" type="number" step="0.01" placeholder="es. 1.10"></div>
      </div>
      <div class="row3">
        <div><label>VE/VCO₂ (nadir o slope)</label><input id="c_vevco2" type="number" step="0.1"></div>
        <div><label>VO₂/WR (ml/min/W)</label><input id="c_vo2wr" type="number" step="0.1" placeholder="vuoto=auto"></div>
        <div><label>O₂ pulse (ml/batt)</label><input id="c_o2pulse" type="number" step="0.1" placeholder="opzionale"></div>
      </div>
      <div class="row3">
        <div><label>OUES (opzionale)</label><input id="c_oues" type="number" step="0.01"></div>
        <div><label>HR picco (bpm)</label><input id="c_hrp" type="number"></div>
        <div><label>HR recovery 1′</label><input id="c_hrr1" type="number"></div>
      </div>
      <div class="row">
        <div><label>PA picco (PAS/PAD)</label><input id="c_bpp" placeholder="190/90"></div>
        <div><label>Note cliniche (opz.)</label><input id="c_notes"></div>
      </div>
      <div class="row">
        <button class="btn secondary" onclick="nav('home')">Indietro</button>
        <button class="btn" onclick="calcCPET()">Calcola</button>
      </div>
    </div>
    <div id="cpet-res" class="card hidden"></div>
  </div>

  <!-- SPIRO -->
  <div id="spiro" class="hidden">
    <div class="card">
      <h2 class="title">Spirometria</h2>
      <div class="row">
        <div><label>Età</label><input id="s_age" type="number"></div>
        <div><label>Sesso</label><select id="s_sex"><option value="M">Maschio</option><option value="F">Femmina</option></select></div>
      </div>
      <div class="row">
        <div><label>Altezza (cm)</label><input id="s_h" type="number"></div>
        <div><label>FEV₁ (L)</label><input id="s_fev1" type="number" step="0.01"></div>
      </div>
      <div class="row">
        <div><label>FVC (L)</label><input id="s_fvc" type="number" step="0.01"></div>
        <div><label>FEV₁/FVC</label><input id="s_ratio" type="number" step="0.01" placeholder="auto se vuoto"></div>
      </div>
      <div class="row">
        <button class="btn secondary" onclick="nav('home')">Indietro</button>
        <button class="btn" onclick="calcSpiro()">Calcola</button>
      </div>
    </div>
    <div id="spiro-res" class="card hidden"></div>
  </div>

  <p class="foot">Sforzu v8.1 • PWA offline • Nessun salvataggio locale.</p>
</main>
<script src="app.js"></script>
</body>
</html>
